{
    "sourceFile": "reset-password.html",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1752931799381,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1754317667780,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -34,70 +34,71 @@\n \r\n         <div id=\"feedbackMessage\" class=\"mt-4 text-center text-sm\"></div>\r\n     </div>\r\n \r\n-    <script>\r\n-        document.addEventListener('DOMContentLoaded', () => {\r\n-            const resetPasswordForm = document.getElementById('resetPasswordForm');\r\n-            const newPasswordInput = document.getElementById('newPassword');\r\n-            const confirmPasswordInput = document.getElementById('confirmPassword');\r\n-            const feedbackMessage = document.getElementById('feedbackMessage');\r\n-            const submitBtn = document.getElementById('submitBtn');\r\n+<script type=\"module\"> // <-- 1. Adicionado type=\"module\"\r\n+    // 2. Importa a variável do ficheiro de configuração\r\n+    import { API_BASE_URL } from './scripts/config.js';\r\n \r\n-            // 1. Extrai o token do URL da página\r\n-            const urlParams = new URLSearchParams(window.location.search);\r\n-            const token = urlParams.get('token');\r\n+    document.addEventListener('DOMContentLoaded', () => {\r\n+        const resetPasswordForm = document.getElementById('resetPasswordForm');\r\n+        const newPasswordInput = document.getElementById('newPassword');\r\n+        const confirmPasswordInput = document.getElementById('confirmPassword');\r\n+        const feedbackMessage = document.getElementById('feedbackMessage');\r\n+        const submitBtn = document.getElementById('submitBtn');\r\n \r\n-            if (!token) {\r\n-                feedbackMessage.className = 'text-red-400';\r\n-                feedbackMessage.textContent = 'Token de recuperação inválido ou em falta.';\r\n-                submitBtn.disabled = true;\r\n-            }\r\n+        const urlParams = new URLSearchParams(window.location.search);\r\n+        const token = urlParams.get('token');\r\n \r\n-            // 2. Adiciona o evento de submissão ao formulário\r\n-            resetPasswordForm.addEventListener('submit', async (e) => {\r\n-                e.preventDefault();\r\n-                const newPassword = newPasswordInput.value;\r\n-                const confirmPassword = confirmPasswordInput.value;\r\n+        if (!token) {\r\n+            feedbackMessage.className = 'text-red-400';\r\n+            feedbackMessage.textContent = 'Token de recuperação inválido ou em falta.';\r\n+            submitBtn.disabled = true;\r\n+        }\r\n \r\n-                if (newPassword !== confirmPassword) {\r\n-                    feedbackMessage.className = 'text-yellow-400';\r\n-                    feedbackMessage.textContent = 'As senhas não coincidem.';\r\n-                    return;\r\n-                }\r\n+        resetPasswordForm.addEventListener('submit', async (e) => {\r\n+            e.preventDefault();\r\n+            const newPassword = newPasswordInput.value;\r\n+            const confirmPassword = confirmPasswordInput.value;\r\n \r\n-                submitBtn.disabled = true;\r\n-                submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Salvando...';\r\n-                feedbackMessage.textContent = '';\r\n+            if (newPassword !== confirmPassword) {\r\n+                feedbackMessage.className = 'text-yellow-400';\r\n+                feedbackMessage.textContent = 'As senhas não coincidem.';\r\n+                return;\r\n+            }\r\n \r\n-                try {\r\n-                    // 3. Envia o pedido para a nossa API do backend\r\n-                    const response = await fetch(`http://localhost:5000/api/auth/reset-password/${token}`, {\r\n-                        method: 'POST',\r\n-                        headers: { 'Content-Type': 'application/json' },\r\n-                        body: JSON.stringify({ password: newPassword })\r\n-                    });\r\n-                    const data = await response.json();\r\n+            submitBtn.disabled = true;\r\n+            submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Salvando...';\r\n+            feedbackMessage.textContent = '';\r\n \r\n-                    if (!response.ok) {\r\n-                        throw new Error(data.message);\r\n-                    }\r\n+            try {\r\n+                // 3. Substitui a URL fixa pela variável importada\r\n+                const response = await fetch(`${API_BASE_URL}/api/auth/reset-password/${token}`, {\r\n+                    method: 'POST',\r\n+                    headers: { 'Content-Type': 'application/json' },\r\n+                    body: JSON.stringify({ password: newPassword })\r\n+                });\r\n+                const data = await response.json();\r\n \r\n-                    feedbackMessage.className = 'text-green-400';\r\n-                    feedbackMessage.innerHTML = `${data.message} Você será redirecionado para a página de login em 5 segundos.`;\r\n-                    \r\n-                    setTimeout(() => {\r\n-                        window.location.href = 'OrgBoletos.html';\r\n-                    }, 5000);\r\n+                if (!response.ok) {\r\n+                    throw new Error(data.message);\r\n+                }\r\n \r\n-                } catch (error) {\r\n-                    feedbackMessage.className = 'text-red-400';\r\n-                    feedbackMessage.textContent = error.message;\r\n-                    submitBtn.disabled = false;\r\n-                    submitBtn.innerHTML = 'Salvar Nova Senha';\r\n-                }\r\n-            });\r\n+                feedbackMessage.className = 'text-green-400';\r\n+                feedbackMessage.innerHTML = `${data.message} Você será redirecionado para a página de login em 5 segundos.`;\r\n+                \r\n+                setTimeout(() => {\r\n+                    window.location.href = 'Index.html'; // Corrigido para apontar para Index.html\r\n+                }, 5000);\r\n+\r\n+            } catch (error) {\r\n+                feedbackMessage.className = 'text-red-400';\r\n+                feedbackMessage.textContent = error.message;\r\n+                submitBtn.disabled = false;\r\n+                submitBtn.innerHTML = 'Salvar Nova Senha';\r\n+            }\r\n         });\r\n-    </script>\r\n+    });\r\n+</script>\r\n \r\n </body>\r\n </html>\n\\ No newline at end of file\n"
                },
                {
                    "date": 1754520135131,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,11 +5,9 @@\n     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n     <title>Definir Nova Senha - Organizador de Boletos</title>\r\n     <script src=\"https://cdn.tailwindcss.com\"></script>\r\n     <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n-    <style>\r\n-        body { background-color: #0f172a; font-family: 'Poppins', sans-serif; }\r\n-    </style>\r\n+    <link rel=\"stylesheet\" href=\"style.css\">\r\n </head>\r\n <body class=\"bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center\">\r\n \r\n     <div class=\"w-full max-w-md bg-gray-800 rounded-lg shadow-md p-8\">\r\n"
                },
                {
                    "date": 1754520148956,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,8 @@\n <head>\r\n     <meta charset=\"UTF-8\">\r\n     <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n     <title>Definir Nova Senha - Organizador de Boletos</title>\r\n-    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n     <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n     <link rel=\"stylesheet\" href=\"style.css\">\r\n </head>\r\n <body class=\"bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center\">\r\n"
                }
            ],
            "date": 1752931799381,
            "name": "Commit-0",
            "content": "<!DOCTYPE html>\r\n<html lang=\"pt-BR\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Definir Nova Senha - Organizador de Boletos</title>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n    <style>\r\n        body { background-color: #0f172a; font-family: 'Poppins', sans-serif; }\r\n    </style>\r\n</head>\r\n<body class=\"bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center\">\r\n\r\n    <div class=\"w-full max-w-md bg-gray-800 rounded-lg shadow-md p-8\">\r\n        <h2 class=\"text-2xl font-bold text-center text-indigo-400 mb-6\">Definir Nova Senha</h2>\r\n        \r\n        <form id=\"resetPasswordForm\" class=\"space-y-4\">\r\n            <div>\r\n                <label for=\"newPassword\" class=\"block text-sm font-medium text-gray-300 mb-1\">Nova Senha</label>\r\n                <input type=\"password\" id=\"newPassword\" required\r\n                       class=\"w-full px-4 py-2 border border-gray-600 rounded-md bg-gray-700 text-white focus:ring-2 focus:ring-indigo-300\">\r\n            </div>\r\n            <div>\r\n                <label for=\"confirmPassword\" class=\"block text-sm font-medium text-gray-300 mb-1\">Confirmar Nova Senha</label>\r\n                <input type=\"password\" id=\"confirmPassword\" required\r\n                       class=\"w-full px-4 py-2 border border-gray-600 rounded-md bg-gray-700 text-white focus:ring-2 focus:ring-indigo-300\">\r\n            </div>\r\n            <button type=\"submit\" id=\"submitBtn\"\r\n                class=\"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-200\">\r\n                Salvar Nova Senha\r\n            </button>\r\n        </form>\r\n\r\n        <div id=\"feedbackMessage\" class=\"mt-4 text-center text-sm\"></div>\r\n    </div>\r\n\r\n    <script>\r\n        document.addEventListener('DOMContentLoaded', () => {\r\n            const resetPasswordForm = document.getElementById('resetPasswordForm');\r\n            const newPasswordInput = document.getElementById('newPassword');\r\n            const confirmPasswordInput = document.getElementById('confirmPassword');\r\n            const feedbackMessage = document.getElementById('feedbackMessage');\r\n            const submitBtn = document.getElementById('submitBtn');\r\n\r\n            // 1. Extrai o token do URL da página\r\n            const urlParams = new URLSearchParams(window.location.search);\r\n            const token = urlParams.get('token');\r\n\r\n            if (!token) {\r\n                feedbackMessage.className = 'text-red-400';\r\n                feedbackMessage.textContent = 'Token de recuperação inválido ou em falta.';\r\n                submitBtn.disabled = true;\r\n            }\r\n\r\n            // 2. Adiciona o evento de submissão ao formulário\r\n            resetPasswordForm.addEventListener('submit', async (e) => {\r\n                e.preventDefault();\r\n                const newPassword = newPasswordInput.value;\r\n                const confirmPassword = confirmPasswordInput.value;\r\n\r\n                if (newPassword !== confirmPassword) {\r\n                    feedbackMessage.className = 'text-yellow-400';\r\n                    feedbackMessage.textContent = 'As senhas não coincidem.';\r\n                    return;\r\n                }\r\n\r\n                submitBtn.disabled = true;\r\n                submitBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i> Salvando...';\r\n                feedbackMessage.textContent = '';\r\n\r\n                try {\r\n                    // 3. Envia o pedido para a nossa API do backend\r\n                    const response = await fetch(`http://localhost:5000/api/auth/reset-password/${token}`, {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({ password: newPassword })\r\n                    });\r\n                    const data = await response.json();\r\n\r\n                    if (!response.ok) {\r\n                        throw new Error(data.message);\r\n                    }\r\n\r\n                    feedbackMessage.className = 'text-green-400';\r\n                    feedbackMessage.innerHTML = `${data.message} Você será redirecionado para a página de login em 5 segundos.`;\r\n                    \r\n                    setTimeout(() => {\r\n                        window.location.href = 'OrgBoletos.html';\r\n                    }, 5000);\r\n\r\n                } catch (error) {\r\n                    feedbackMessage.className = 'text-red-400';\r\n                    feedbackMessage.textContent = error.message;\r\n                    submitBtn.disabled = false;\r\n                    submitBtn.innerHTML = 'Salvar Nova Senha';\r\n                }\r\n            });\r\n        });\r\n    </script>\r\n\r\n</body>\r\n</html>"
        }
    ]
}